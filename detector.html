<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEZ SRP ‚Äî –î–µ—Ç–µ–∫—Ç–æ—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤</title>
    <style>
        body {
            background: #17161c url('images/fon.jpg') no-repeat center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            background: rgba(0,0,0,0.75);
            padding: 40px;
            border-radius: 12px;
            max-width: 700px;
            margin: 40px auto;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            text-align: center;
        }
        h1 { font-size: 2.6em; color: #DCDCDC; margin-bottom: 10px; }
        .subtitle { font-size: 1.3em; opacity: 0.9; margin-bottom: 35px; }
        label, select, input, button {
            font-size: 1.2em;
            margin: 15px auto;
            display: block;
            width: 100%;
            max-width: 400px;
        }
        select, 
        input[type="text"], 
        button {
            font-size: 1.2em;
            margin: 15px auto;
            display: block;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
        }

        select, 
        input[type="text"] {
            padding: 12px;
            border: 1px solid #a9c1d9;
            border-radius: 8px;
            background: #1a1d23;
            color: #e0e0e0;
            height: 50px;
        }

        button {
            padding: 12px;
            height: 50px;
            font-weight: bold;
            background: linear-gradient(135deg, #2a2f3a, #1a1d23);
            color: #a9c1d9;
            border: 2px solid #a9c1d9;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1;
        }

        button:hover {
            transform: translateY(-4px);
            background: linear-gradient(135deg, #3a3f4a, #2a2d3b);
            color: white;
            box-shadow: 0 8px 20px rgba(169,193,217,0.3);
        }

        button:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none;
        }
        
        #detector-area {
            margin: 10px auto 10px;
            width: 380px;
            max-width: 100%;
            height: auto;
            aspect-ratio: 1/1;
            position: relative;
            border: 2px solid #a9c1d9;
            border-radius: 12px;
            overflow: hidden;
            background: #111;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        
        #detector-bg { 
            width: 100%; 
            height: 100%; 
            object-fit: contain;
        }
        
        #player-number {
            position: absolute;
            top: 4%;
            left: 50%;
            transform: translateX(-50%);
            font-size: min(2.4em, 8vw);
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 0 0 12px #ffcc00;
            z-index: 3;
            white-space: nowrap;
            max-width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ */
        #scan-number {
            position: absolute;
            bottom: 4%;
            left: 50%;
            transform: translateX(-50%);
            font-size: min(1.2em, 4vw);
            color: #a9c1d9;
            text-shadow: 0 0 8px #a9c1d9;
            z-index: 3;
            background: rgba(0,0,0,0.5);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid #a9c1d9;
            backdrop-filter: blur(2px);
            white-space: nowrap;
        }
        
        #result {
            margin-top: 0px;
            font-size: min(1.5em, 8vw);
            font-weight: bold;
            min-height: 0px;
            word-break: break-word;
        }
        .artifact-rare { color: #00ffea; text-shadow: 0 0 10px #00ffea; }
        .artifact-legend { color: #ff00aa; text-shadow: 0 0 15px #ff00aa; }

        #artifact-notification {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .notification-box {
            background: rgba(26,29,35,0.95);
            padding: 50px 60px;
            border-radius: 16px;
            border: 3px solid #a9c1d9;
            box-shadow: 0 0 40px rgba(169,193,217,0.5);
            text-align: center;
            max-width: 600px;
            width: 90%;
        }
        .notification-title { font-size: 2.2em; margin-bottom: 20px; color: #ffcc00; }
        .notification-text { font-size: 1.6em; margin: 20px 0 40px; }
        .notification-btn {
            padding: 16px 40px;
            font-size: 1.3em;
            margin: 0 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }
        .btn-take { background: #00cc66; color: white; }
        .btn-take:hover { background: #00b359; transform: scale(1.08); }
        .btn-drop { background: #cc0000; color: white; }
        .btn-drop:hover { background: #b30000; transform: scale(1.08); }

        #log {
            margin-top: 30px;
            background: rgba(0,0,0,0.6);
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
            color: #0f0;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 15px;
            }
            h1 {
                font-size: 2em;
            }
            .subtitle {
                font-size: 1.1em;
            }
            #player-number {
                font-size: min(2em, 7vw);
            }
            #scan-number {
                font-size: min(1em, 3.5vw);
                padding: 3px 8px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>–î–µ—Ç–µ–∫—Ç–æ—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤</h1>
        <div class="subtitle">CEZ SRP</div>

        <label for="detector-type">–¢–∏–ø –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞:</label>
        <select id="detector-type">
            <option value="–û—Ç–∫–ª–∏–∫">–û—Ç–∫–ª–∏–∫</option>
            <option value="–ú–µ–¥–≤–µ–¥—å">–ú–µ–¥–≤–µ–¥—å</option>
            <option value="–í–µ–ª–µ—Å">–í–µ–ª–µ—Å</option>
            <option value="–°–≤–∞—Ä–æ–≥">–°–≤–∞—Ä–æ–≥</option>
        </select>

        <label for="anomaly-type">–¢–∏–ø –∞–Ω–æ–º–∞–ª–∏–∏:</label>
        <select id="anomaly-type">
            <option value="none">–ë–µ–∑ –∞–Ω–æ–º–∞–ª–∏–∏</option>
            <option value="–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è">–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è</option>
            <option value="–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è</option>
            <option value="–¢–µ—Ä–º–∏—á–µ—Å–∫–∞—è">–¢–µ—Ä–º–∏—á–µ—Å–∫–∞—è</option>
        </select>

        <label for="player-id">–ù–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞:</label>
        <input type="text" id="player-id" placeholder="–í–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–æ–º–µ—Ä" maxlength="10">

        <button id="scan-btn">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞—Ä—è–¥–∞ -->
        <div id="charge-display" style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; font-size: 1.1em; color: #a9c1d9;"></div>
                
        <div id="detector-area">
            <img id="detector-bg" src="" alt="–î–µ—Ç–µ–∫—Ç–æ—Ä">
            <div id="player-number"></div>
            <div id="scan-number"></div>
        </div>
        
        <div id="result"></div>

        <div id="log">–õ–æ–≥ –æ—Ç–ª–∞–¥–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):<br></div>
    </div>

    <div id="artifact-notification">
        <div class="notification-box">
            <div class="notification-title">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω!</div>
            <div class="notification-text" id="found-artifact"></div>
            <button class="scan-btn" onclick="handleArtifactAction('–∑–∞–±—Ä–∞–ª')">–ó–∞–±—Ä–∞—Ç—å</button>
            <button class="scan-btn" onclick="handleArtifactAction('–≤—ã–±—Ä–æ—Å–∏–ª')">–í—ã–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>

    <script>
        const logDiv = document.getElementById('log');
        function addLog(message) {
            console.log(message);
            logDiv.innerHTML += message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        const detectorType = document.getElementById('detector-type');
        const anomalyType = document.getElementById('anomaly-type');
        const playerIdInput = document.getElementById('player-id');
        const scanBtn = document.getElementById('scan-btn');
        const detectorImg = document.getElementById('detector-bg');
        const playerNumberDisplay = document.getElementById('player-number');
        const scanNumberDisplay = document.getElementById('scan-number');
        const resultDiv = document.getElementById('result');

        const detectorImages = {
            "–û—Ç–∫–ª–∏–∫": 'images/detectors/otklik.png',
            "–ú–µ–¥–≤–µ–¥—å": 'images/detectors/medved.png',
            "–í–µ–ª–µ—Å": 'images/detectors/veles.png',
            "–°–≤–∞—Ä–æ–≥": 'images/detectors/svarog.png'
        };

        let artifacts = [];
        let currentScanNumber = ''; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —á–∏—Å–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        
        // ============ –°–ò–°–¢–ï–ú–ê –ó–ê–†–Ø–î–û–í –î–õ–Ø –ö–ê–ñ–î–û–ì–û –î–ï–¢–ï–ö–¢–û–†–ê ============
        // –ó–∞—Ä—è–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        let detectorCharge = {
            "–û—Ç–∫–ª–∏–∫": 5,
            "–ú–µ–¥–≤–µ–¥—å": 4,
            "–í–µ–ª–µ—Å": 3,
            "–°–≤–∞—Ä–æ–≥": 3
        };

        // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        let lastChargeTime = {
            "–û—Ç–∫–ª–∏–∫": Date.now(),
            "–ú–µ–¥–≤–µ–¥—å": Date.now(),
            "–í–µ–ª–µ—Å": Date.now(),
            "–°–≤–∞—Ä–æ–≥": Date.now()
        };

        let scanTimeout = null;
        let isScanning = false;
        let scanStartTime = null;
        const scanDuration = 5000; // 5 —Å–µ–∫—É–Ω–¥

        // –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤ (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
        const detectorRegenTime = {
            "–û—Ç–∫–ª–∏–∫": 30000,    // 30 —Å–µ–∫—É–Ω–¥
            "–ú–µ–¥–≤–µ–¥—å": 45000,   // 45 —Å–µ–∫—É–Ω–¥  
            "–í–µ–ª–µ—Å": 60000,     // 1 –º–∏–Ω—É—Ç–∞
            "–°–≤–∞—Ä–æ–≥": 120000    // 2 –º–∏–Ω—É—Ç—ã
        };

        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–∞—Ä—è–¥ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤
        const detectorMaxCharge = {
            "–û—Ç–∫–ª–∏–∫": 5,
            "–ú–µ–¥–≤–µ–¥—å": 4,
            "–í–µ–ª–µ—Å": 3,
            "–°–≤–∞—Ä–æ–≥": 3
        };

        // –ö–ª—é—á–∏ –¥–ª—è localStorage
        const STORAGE_KEYS = {
            CHARGE: 'detector_charge_all',
            LAST_TIME: 'last_charge_time_all',
            SCAN_STATE: 'scan_state'
        };

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ 5-–∑–Ω–∞—á–Ω–æ–≥–æ —á–∏—Å–ª–∞
        function generateScanNumber() {
            return Math.floor(10000 + Math.random() * 90000).toString();
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—Ä—è–¥–æ–≤ –∏–∑ localStorage
        function loadChargesFromStorage() {
            try {
                const savedCharges = localStorage.getItem(STORAGE_KEYS.CHARGE);
                const savedTimes = localStorage.getItem(STORAGE_KEYS.LAST_TIME);
                
                const now = Date.now();
                
                if (savedCharges && savedTimes) {
                    const charges = JSON.parse(savedCharges);
                    const times = JSON.parse(savedTimes);
                    
                    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ä—è–¥ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    Object.keys(detectorMaxCharge).forEach(detector => {
                        const maxCharge = detectorMaxCharge[detector] || 5;
                        const regenTime = detectorRegenTime[detector] || 60000;
                        
                        if (charges[detector] !== undefined && times[detector]) {
                            const timePassed = now - times[detector];
                            const chargesToAdd = Math.floor(timePassed / regenTime);
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ä—è–¥, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞
                            detectorCharge[detector] = Math.min(maxCharge, charges[detector] + chargesToAdd);
                            lastChargeTime[detector] = now;
                            
                            addLog(`–î–µ—Ç–µ–∫—Ç–æ—Ä ${detector}: –∑–∞—Ä—è–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ${detectorCharge[detector]}/${maxCharge} (–ø—Ä–æ—à–ª–æ ${Math.floor(timePassed/1000)}—Å, +${chargesToAdd} –∑–∞—Ä—è–¥–æ–≤)`);
                        } else {
                            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º
                            detectorCharge[detector] = maxCharge;
                            lastChargeTime[detector] = now;
                        }
                    });
                } else {
                    // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ–º –º–∞–∫—Å–∏–º—É–º
                    Object.keys(detectorMaxCharge).forEach(detector => {
                        detectorCharge[detector] = detectorMaxCharge[detector] || 5;
                        lastChargeTime[detector] = now;
                    });
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                saveChargesToStorage();
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—Ä—è–¥–æ–≤:", e);
                const now = Date.now();
                Object.keys(detectorMaxCharge).forEach(detector => {
                    detectorCharge[detector] = detectorMaxCharge[detector] || 5;
                    lastChargeTime[detector] = now;
                });
            }
            
            updateChargeDisplay();
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—Ä—è–¥–æ–≤ –≤ localStorage
        function saveChargesToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.CHARGE, JSON.stringify(detectorCharge));
                localStorage.setItem(STORAGE_KEYS.LAST_TIME, JSON.stringify(lastChargeTime));
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—Ä—è–¥–æ–≤:", e);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞—Ä—è–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        function checkAndRegenCharge() {
            const currentDetector = detectorType.value;
            const now = Date.now();
            const timePassed = now - lastChargeTime[currentDetector];
            const regenTime = detectorRegenTime[currentDetector] || 60000;
            const maxCharge = detectorMaxCharge[currentDetector] || 5;
            const chargesToAdd = Math.floor(timePassed / regenTime);
            
            if (chargesToAdd > 0) {
                const oldCharge = detectorCharge[currentDetector];
                detectorCharge[currentDetector] = Math.min(maxCharge, detectorCharge[currentDetector] + chargesToAdd);
                lastChargeTime[currentDetector] = now;
                
                if (oldCharge !== detectorCharge[currentDetector]) {
                    addLog(`–î–µ—Ç–µ–∫—Ç–æ—Ä ${currentDetector}: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${detectorCharge[currentDetector] - oldCharge} –∑–∞—Ä—è–¥–æ–≤`);
                    saveChargesToStorage();
                    updateChargeDisplay();
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞—Ä—è–¥–∞
        function updateChargeDisplay() {
            const chargeElement = document.getElementById('charge-display');
            if (chargeElement) {
                const currentDetector = detectorType.value;
                const currentCharge = detectorCharge[currentDetector] || 0;
                const maxCharge = detectorMaxCharge[currentDetector] || 5;
                const regenTime = detectorRegenTime[currentDetector] || 60000;
                
                const minutes = Math.floor(regenTime / 60000);
                const seconds = (regenTime % 60000) / 1000;
                const timeText = minutes > 0 ? `${minutes} –º–∏–Ω` : `${seconds} —Å–µ–∫`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞—Ä—è–¥—ã –≤—Å–µ—Ö –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤
                let allDetectorsInfo = '<br><small>–î—Ä—É–≥–∏–µ –¥–µ—Ç–µ–∫—Ç–æ—Ä—ã:</small>';
                Object.keys(detectorMaxCharge).forEach(detector => {
                    if (detector !== currentDetector) {
                        allDetectorsInfo += `<br><small>${detector}: ${detectorCharge[detector] || 0}/${detectorMaxCharge[detector]}</small>`;
                    }
                });
                
                chargeElement.innerHTML = `üîã –¢–µ–∫—É—â–∏–π –¥–µ—Ç–µ–∫—Ç–æ—Ä (${currentDetector}): ${currentCharge}/${maxCharge}<br>
                    <small>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: +1 –∑–∞—Ä—è–¥ –∫–∞–∂–¥—ã–µ ${timeText}</small>
                    ${allDetectorsInfo}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ç—Ä–∞—Ç—ã –∑–∞—Ä—è–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        function spendCharge() {
            const currentDetector = detectorType.value;
            if (detectorCharge[currentDetector] > 0) {
                detectorCharge[currentDetector]--;
                lastChargeTime[currentDetector] = Date.now();
                saveChargesToStorage();
                updateChargeDisplay();
                return true;
            }
            return false;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞—Ä—è–¥–∞
        function getCurrentCharge() {
            const currentDetector = detectorType.value;
            return detectorCharge[currentDetector] || 0;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ä—è–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        function getCurrentMaxCharge() {
            return detectorMaxCharge[detectorType.value] || 5;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function saveScanState() {
            if (isScanning && scanStartTime) {
                const state = {
                    isScanning: true,
                    scanStartTime: scanStartTime,
                    playerId: playerIdInput.value.trim(),
                    detectorType: detectorType.value,
                    anomalyType: anomalyType.value,
                    scanNumber: currentScanNumber
                };
                localStorage.setItem(STORAGE_KEYS.SCAN_STATE, JSON.stringify(state));
            } else {
                localStorage.removeItem(STORAGE_KEYS.SCAN_STATE);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function restoreScanState() {
            const savedState = localStorage.getItem(STORAGE_KEYS.SCAN_STATE);
            if (!savedState) return false;
            
            try {
                const state = JSON.parse(savedState);
                const now = Date.now();
                const elapsedTime = now - state.scanStartTime;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ç–æ—Ç –∂–µ –ª–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä
                if (state.detectorType !== detectorType.value) {
                    localStorage.removeItem(STORAGE_KEYS.SCAN_STATE);
                    return false;
                }
                
                // –ï—Å–ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ —É–∂–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
                if (elapsedTime >= scanDuration) {
                    // –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ä–∞–∑—É
                    completeScan(state.playerId, state.detectorType, state.anomalyType);
                    return true;
                }
                
                // –ï—Å–ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—â–µ –∏–¥–µ—Ç
                if (elapsedTime < scanDuration && state.isScanning) {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    isScanning = true;
                    scanStartTime = state.scanStartTime;
                    playerIdInput.value = state.playerId;
                    detectorType.value = state.detectorType;
                    anomalyType.value = state.anomalyType;
                    currentScanNumber = state.scanNumber || generateScanNumber();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ü–∏—é
                    playerNumberDisplay.textContent = state.playerId;
                    scanNumberDisplay.textContent = `#${currentScanNumber}`;
                    scanBtn.textContent = "–û—Ç–º–µ–Ω–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ";
                    
                    const remainingSeconds = Math.ceil((scanDuration - elapsedTime)/1000);
                    resultDiv.textContent = `–î–µ—Ç–µ–∫—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç... (–æ—Å—Ç–∞–ª–æ—Å—å ${remainingSeconds} —Å–µ–∫)`;
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –Ω–∞ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
                    const remainingTime = scanDuration - elapsedTime;
                    scanTimeout = setTimeout(() => {
                        completeScan(state.playerId, state.detectorType, state.anomalyType);
                    }, remainingTime);
                    
                    addLog(`–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ—Å—Ç–∞–ª–æ—Å—å ${remainingSeconds} —Å–µ–∫, –Ω–æ–º–µ—Ä #${currentScanNumber}`);
                    return true;
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:", e);
            }
            
            return false;
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function completeScan(playerId, detector, anomaly) {
            // –¢—Ä–∞—Ç–∏–º –∑–∞—Ä—è–¥
            spendCharge();
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
            performArtifactSearch(playerId, detector, anomaly);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            isScanning = false;
            scanStartTime = null;
            scanTimeout = null;
            saveScanState();
            
            scanBtn.disabled = false;
            scanBtn.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å";
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
        function performArtifactSearch(playerId, selectedDetector, selectedAnomaly) {
            addLog("–î–µ—Ç–µ–∫—Ç–æ—Ä: " + selectedDetector);
            addLog("–ê–Ω–æ–º–∞–ª–∏—è: " + selectedAnomaly);

            if (artifacts.length === 0) {
                resultDiv.textContent = "–ë–∞–∑–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!";
                addLog("–û—à–∏–±–∫–∞: artifacts –ø—É—Å—Ç–æ–π");
                return;
            }

            addLog("–ù–∞—á–∞–ª–æ –ø–æ–¥—Å—á—ë—Ç–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Å —É—á–µ—Ç–æ–º –∞–Ω–æ–º–∞–ª–∏–∏)...");

            let totalWeight = 0;
            const weightedList = [];

            artifacts.forEach(art => {
                const artifactAnomaly = art['–ê–Ω–æ–º–∞–ª–∏—è'] || '';
                const artifactName = art['–ê—Ä—Ç–µ—Ñ–∞–∫—Ç \\ –î–µ—Ç–µ–∫—Ç–æ—Ä'] || '';
                
                let prob = parseInt(art[selectedDetector] || 0, 10);
                
                if (artifactName.toLowerCase() === 'nothing') {
                    if (prob > 0) {
                        totalWeight += prob;
                        weightedList.push({ art, weight: prob });
                        addLog(`–î–æ–±–∞–≤–ª–µ–Ω: ${artifactName} (–í–°–ï–ì–î–ê, –≤–µ—Å ${prob} –∏–∑ —Ç–∞–±–ª–∏—Ü—ã)`);
                    }
                    return;
                }
                
                let anomalyMatch = false;
                
                if (selectedAnomaly === 'none') {
                    anomalyMatch = !artifactAnomaly || artifactAnomaly.toLowerCase() === 'none' || artifactAnomaly === '';
                } else {
                    anomalyMatch = artifactAnomaly.toLowerCase() === selectedAnomaly.toLowerCase();
                }
                
                if (!anomalyMatch) {
                    return;
                }

                if (prob > 0) {
                    totalWeight += prob;
                    weightedList.push({ art, weight: prob });
                    addLog(`–î–æ–±–∞–≤–ª–µ–Ω: ${artifactName} (–∞–Ω–æ–º–∞–ª–∏—è: ${artifactAnomaly}, –≤–µ—Å ${prob})`);
                }
            });

            addLog("–û–±—â–∏–π –≤–µ—Å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –∞–Ω–æ–º–∞–ª–∏–∏: " + totalWeight);
            
            if (totalWeight === 0) {
                addLog("–ù–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∞–Ω–æ–º–∞–ª–∏–∏");
                resultDiv.textContent = "–í —ç—Ç–æ–π –∞–Ω–æ–º–∞–ª–∏–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
                notifyTelegram('–∑–∞–≤–µ—Ä—à–∏–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≤ —ç—Ç–æ–π –∞–Ω–æ–º–∞–ª–∏–∏)');
                return;
            }

            let artifact = { '–ê—Ä—Ç–µ—Ñ–∞–∫—Ç \\ –î–µ—Ç–µ–∫—Ç–æ—Ä': "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" };

            if (totalWeight > 0) {
                let random = Math.random() * totalWeight;
                for (const item of weightedList) {
                    random -= item.weight;
                    if (random <= 0) {
                        artifact = item.art;
                        break;
                    }
                }
            }

            const artName = artifact['–ê—Ä—Ç–µ—Ñ–∞–∫—Ç \\ –î–µ—Ç–µ–∫—Ç–æ—Ä'] || "–±–µ–∑ –∏–º–µ–Ω–∏";
            addLog("–í—ã–±—Ä–∞–Ω: " + artName);

            const lowerName = artName.toLowerCase();
            if (lowerName === "nothing" || lowerName === "–Ω–∏—á–µ–≥–æ" || lowerName === "") {
                resultDiv.textContent = "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
                addLog("–†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∏—á–µ–≥–æ");
                notifyTelegram('–∑–∞–≤–µ—Ä—à–∏–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', `–†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–æ–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: #${currentScanNumber})`);
            } else {
                let colorClass = '';
                const rarity = artifact.rarity?.toLowerCase() || 'common';
                if (rarity === 'rare') colorClass = 'artifact-rare';
                if (rarity === 'legend') colorClass = 'artifact-legend';

                resultDiv.innerHTML = "–û–±–Ω–∞—Ä—É–∂–µ–Ω –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: " + artName;

                document.getElementById('found-artifact').innerHTML = artName;
                document.getElementById('artifact-notification').style.display = 'flex';

                addLog("–†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∞–π–¥–µ–Ω " + artName);
                notifyTelegram('–æ–±–Ω–∞—Ä—É–∂–∏–ª –∞—Ä—Ç–µ—Ñ–∞–∫—Ç', `–ù–∞–π–¥–µ–Ω: ${artName} (${rarity}) –≤ –∞–Ω–æ–º–∞–ª–∏–∏ ${selectedAnomaly} (–Ω–æ–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: #${currentScanNumber})`);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        detectorType.addEventListener('change', () => {
            const selected = detectorType.value;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ä—è–¥ –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
            checkAndRegenCharge();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateChargeDisplay();
            addLog(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä ${selected}: –∑–∞—Ä—è–¥ ${detectorCharge[selected]}/${detectorMaxCharge[selected]}`);
            
            // –ú–µ–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
            detectorImg.src = detectorImages[selected] || 'images/detectors/default.png';
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            loadChargesFromStorage();
            
            if (!restoreScanState()) {
                updateChargeDisplay();
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                currentScanNumber = generateScanNumber();
                scanNumberDisplay.textContent = `#${currentScanNumber}`;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Å –æ—Ç–º–µ–Ω–æ–π –∏ –∑–∞—Ä—è–¥–æ–º
        scanBtn.addEventListener('click', () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ä—è–¥ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
            checkAndRegenCharge();
            
            // –ï—Å–ª–∏ —É–∂–µ –∏–¥–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Ç–º–µ–Ω—è–µ–º
            if (isScanning) {
                if (scanTimeout) {
                    clearTimeout(scanTimeout);
                    scanTimeout = null;
                }
                
                isScanning = false;
                scanStartTime = null;
                saveScanState();
                
                scanBtn.disabled = false;
                scanBtn.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å";
                resultDiv.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ";
                addLog("–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ä—è–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
            if (getCurrentCharge() <= 0) {
                alert("–ù–µ—Ç –∑–∞—Ä—è–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞! –ü–æ–¥–æ–∂–¥–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.");
                return;
            }
            
            const playerId = playerIdInput.value.trim();
            if (!playerId) {
                alert("–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞!");
                return;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ —á–∏—Å–ª–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            currentScanNumber = generateScanNumber();

            // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            isScanning = true;
            scanStartTime = Date.now();
            playerNumberDisplay.textContent = playerId;
            scanNumberDisplay.textContent = `#${currentScanNumber}`;
            addLog(`–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ. –ò–≥—Ä–æ–∫: ${playerId}, –Ω–æ–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: #${currentScanNumber}`);
            
            notifyTelegram('–Ω–∞—á–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', `–Ω–æ–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: #${currentScanNumber}`);

            scanBtn.disabled = false;
            scanBtn.textContent = "–û—Ç–º–µ–Ω–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ";
            resultDiv.textContent = "–î–µ—Ç–µ–∫—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç... (–Ω–∞–∂–º–∏ '–û—Ç–º–µ–Ω–∏—Ç—å' –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è)";

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            saveScanState();

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            scanTimeout = setTimeout(() => {
                completeScan(playerId, detectorType.value, anomalyType.value);
            }, scanDuration);
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
        function notifyTelegram(action, details = '') {
            const token = '7601048796:AAG6n3IO8E4K0CgqAl-SETz70ERsSci9DL4';
            const chatId = '-1003590431257';
            
            const playerId = playerIdInput.value.trim() || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            const detector = detectorType.value;
            const anomaly = anomalyType.value === 'none' ? '–±–µ–∑ –∞–Ω–æ–º–∞–ª–∏–∏' : anomalyType.value;
            
            let text = `üéÆ –ò–≥—Ä–æ–∫ ${playerId}\n`;
            text += `üì° –î–µ—Ç–µ–∫—Ç–æ—Ä: ${detector}\n`;
            text += `üå™ –ê–Ω–æ–º–∞–ª–∏—è: ${anomaly}\n`;
            text += `üîã –ó–∞—Ä—è–¥: ${getCurrentCharge()}/${getCurrentMaxCharge()}\n`;
            text += `üÜî –ù–æ–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: #${currentScanNumber}\n`;
            text += `üîÑ –î–µ–π—Å—Ç–≤–∏–µ: ${action}\n`;
            
            if (details) {
                text += `üìù ${details}`;
            }
            
            fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(text)}`)
                .catch(error => addLog('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram: ' + error));
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–º
        function handleArtifactAction(action) {
            const artifactName = document.getElementById('found-artifact').textContent;
            notifyTelegram(action, `–ê—Ä—Ç–µ—Ñ–∞–∫—Ç: ${artifactName}`);
            closeNotification();
        }

        async function loadArtifacts() {
            addLog("–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã...");
            try {
                const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQH7LcXjMumSy4IsPJ-wWnxMF91UeyF193u7deot4q2bJC_Koa03Sh5OIr71JJ2UNk7rKrrc5LxcW7M/pub?output=csv&gid=0';

                addLog("–ó–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ...");
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status}`);

                const csvText = await response.text();
                addLog("CSV –ø–æ–ª—É—á–µ–Ω (" + csvText.length + " —Å–∏–º–≤–æ–ª–æ–≤)");

                const lines = csvText.trim().split('\n');
                addLog("–°—Ç—Ä–æ–∫ –≤ CSV: " + lines.length);

                if (lines.length < 2) throw new Error('–¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è');

                const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
                addLog("–ó–∞–≥–æ–ª–æ–≤–∫–∏: " + headers.join(", "));

                artifacts = lines.slice(1).map(line => {
                    const values = line.split(',').map(v => v.trim().replace(/^"|"$/g, ''));
                    const obj = {};
                    headers.forEach((header, i) => {
                        obj[header.trim()] = values[i] || '';
                    });
                    return obj;
                });

                addLog(`–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${artifacts.length}`);
                if (artifacts.length > 0) {
                    addLog("–ü–µ—Ä–≤—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: " + (artifacts[0]['–ê—Ä—Ç–µ—Ñ–∞–∫—Ç \\ –î–µ—Ç–µ–∫—Ç–æ—Ä'] || '–∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω'));
                    addLog("–í—Ç–æ—Ä–æ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: " + (artifacts[1] ? artifacts[1]['–ê—Ä—Ç–µ—Ñ–∞–∫—Ç \\ –î–µ—Ç–µ–∫—Ç–æ—Ä'] : "–Ω–µ—Ç"));
                }

                resultDiv.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${artifacts.length} –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤`;
            } catch (err) {
                addLog("–û–®–ò–ë–ö–ê –∑–∞–≥—Ä—É–∑–∫–∏: " + err.message);
                resultDiv.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É';
            }
        }

        loadArtifacts();

        function closeNotification() {
            document.getElementById('artifact-notification').style.display = 'none';
        }

        detectorImg.src = detectorImages[detectorType.value];
    </script>
</body>
</html>
